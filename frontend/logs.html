<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ“ä½œæ—¥èªŒ - æ¼æ´å ±å‘Šç®¡ç†ç³»çµ±</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="app-container">
        <!-- å´é‚Šæ¬„ -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">ğŸ›¡ï¸</span>
                    <span class="logo-text">VulnTracker</span>
                </div>
            </div>
            <nav class="sidebar-nav">
                <a href="index.html" class="nav-item">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span class="nav-text">å„€è¡¨æ¿</span>
                </a>
                <a href="reports.html" class="nav-item">
                    <span class="nav-icon">ğŸ“‹</span>
                    <span class="nav-text">å ±å‘Šåˆ—è¡¨</span>
                </a>
                <a href="logs.html" class="nav-item active">
                    <span class="nav-icon">ğŸ“œ</span>
                    <span class="nav-text">æ“ä½œæ—¥èªŒ</span>
                </a>
                <div class="nav-divider"></div>
                <button class="nav-item" id="btn-import">
                    <span class="nav-icon">ğŸ“¥</span>
                    <span class="nav-text">åŒ¯å…¥å ±å‘Š</span>
                </button>
                <a href="settings.html" class="nav-item">
                    <span class="nav-icon">âš™ï¸</span>
                    <span class="nav-text">ç³»çµ±è¨­å®š</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <div class="version">v1.0.0</div>
            </div>
        </aside>
        
        <!-- ä¸»å…§å®¹å€ -->
        <main class="main-content">
            <div class="page-header">
                <h1>ğŸ“œ æ“ä½œæ—¥èªŒ</h1>
                <div class="page-actions">
                    <select id="filter-type" class="select" onchange="loadLogs(1)">
                        <option value="">å…¨éƒ¨é¡å‹</option>
                        <option value="IMPORT">ğŸ“¥ åŒ¯å…¥</option>
                        <option value="DELETE">ğŸ—‘ï¸ åˆªé™¤</option>
                        <option value="STATUS">ğŸ”„ ç‹€æ…‹æ›´æ–°</option>
                        <option value="EXPORT">ğŸ“¤ åŒ¯å‡º</option>
                    </select>
                    <button class="btn" onclick="loadLogs(1)">ğŸ”„ é‡æ–°æ•´ç†</button>
                </div>
            </div>

            <div class="card">
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th style="width: 180px;">æ™‚é–“</th>
                                <th style="width: 100px;">é¡å‹</th>
                                <th>æ“ä½œå…§å®¹</th>
                            </tr>
                        </thead>
                        <tbody id="logs-tbody">
                            <tr><td colspan="3" class="loading">è¼‰å…¥ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination" id="pagination"></div>
            </div>
        </main>
    </div>
    
    <!-- åŒ¯å…¥ Modal -->
    <div class="modal" id="import-modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“¥ åŒ¯å…¥ JSON å ±å‘Š</h3>
                <button class="modal-close" onclick="closeModal('import-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-zone" id="upload-zone">
                    <div class="upload-icon">ğŸ“</div>
                    <p>æ‹–æ”¾ JSON æª”æ¡ˆåˆ°æ­¤è™•</p>
                    <p class="upload-hint">æˆ–é»æ“Šé¸æ“‡æª”æ¡ˆï¼ˆæ”¯æ´å¤šæª”ï¼‰</p>
                    <input type="file" id="file-input" accept=".json" multiple hidden>
                </div>
                <div class="upload-progress" id="upload-progress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-text" id="progress-text">ä¸Šå‚³ä¸­...</div>
                </div>
                <div class="upload-results" id="upload-results"></div>
            </div>
        </div>
    </div>
    
    <!-- Toast é€šçŸ¥ -->
    <div class="toast-container" id="toast-container"></div>
    
    <script src="config.js"></script>
    <script src="js/common.js"></script>
    <script>
    let currentPage = 1;

    document.addEventListener('DOMContentLoaded', () => loadLogs(1));

    async function loadLogs(page = 1) {
        currentPage = page;
        const tbody = document.getElementById('logs-tbody');
        tbody.innerHTML = '<tr><td colspan="3" class="loading">è¼‰å…¥ä¸­...</td></tr>';
        
        const actionType = document.getElementById('filter-type').value;
        
        try {
            const params = new URLSearchParams({ page, per_page: 50 });
            if (actionType) params.append('type', actionType);
            
            const data = await api(`/logs?${params}`);
            
            if (!data.logs.length) {
                tbody.innerHTML = '<tr><td colspan="3" class="loading">å°šç„¡æ—¥èªŒ</td></tr>';
                document.getElementById('pagination').innerHTML = '';
                return;
            }
            
            tbody.innerHTML = data.logs.map(log => `
                <tr>
                    <td style="font-family: var(--font-mono); font-size: 13px;">${log.created_at}</td>
                    <td>${getTypeLabel(log.action_type)}</td>
                    <td>${escapeHtml(log.message)}</td>
                </tr>
            `).join('');
            
            updatePagination(data.current_page, data.pages, data.total);
            
        } catch (error) {
            tbody.innerHTML = `<tr><td colspan="3" class="loading">è¼‰å…¥å¤±æ•—: ${error.message}</td></tr>`;
        }
    }

    function getTypeLabel(type) {
        const map = {
            'IMPORT': '<span class="status-badge" style="background: rgba(63, 185, 80, 0.2); color: #3fb950;">ğŸ“¥ åŒ¯å…¥</span>',
            'DELETE': '<span class="status-badge" style="background: rgba(248, 81, 73, 0.2); color: #f85149;">ğŸ—‘ï¸ åˆªé™¤</span>',
            'STATUS': '<span class="status-badge" style="background: rgba(88, 166, 255, 0.2); color: #58a6ff;">ğŸ”„ ç‹€æ…‹</span>',
            'EXPORT': '<span class="status-badge" style="background: rgba(210, 153, 34, 0.2); color: #d29922;">ğŸ“¤ åŒ¯å‡º</span>'
        };
        return map[type] || type;
    }

    function updatePagination(current, total, count) {
        const container = document.getElementById('pagination');
        
        if (total <= 1) {
            container.innerHTML = `<span style="color: var(--text-muted);">å…± ${count} ç­†</span>`;
            return;
        }
        
        let html = `<span style="color: var(--text-muted); margin-right: 16px;">å…± ${count} ç­†</span>`;
        html += `<button class="btn btn-sm" ${current === 1 ? 'disabled' : ''} onclick="loadLogs(${current - 1})">â†</button>`;
        
        for (let i = 1; i <= total; i++) {
            if (i === 1 || i === total || (i >= current - 2 && i <= current + 2)) {
                html += `<button class="btn btn-sm ${i === current ? 'active' : ''}" onclick="loadLogs(${i})">${i}</button>`;
            } else if (i === current - 3 || i === current + 3) {
                html += '<span style="color: var(--text-muted);">...</span>';
            }
        }
        
        html += `<button class="btn btn-sm" ${current === total ? 'disabled' : ''} onclick="loadLogs(${current + 1})">â†’</button>`;
        container.innerHTML = html;
    }
    </script>
</body>
</html>

